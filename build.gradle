apply from: "https://raw.githubusercontent.com/gocd/gocd-plugin-gradle-task-helpers/75a8575/helper.gradle"

def baseGroup = 'com.vary.tenantsecrets'
def baseVersion = '0.0.1'

subprojects {
    apply plugin: 'java'

    sourceCompatibility = 1.8
    targetCompatibility = 1.8

    group = baseGroup
    version = baseVersion

    repositories {
        mavenCentral()
    }

    test {
        useJUnitPlatform()
    }
}

gocdPlugin {
    id = baseGroup
    pluginVersion = baseVersion
    goCdVersion = '20.9.0'
    name = 'Tenant secrets plugin'
    description = 'Generates AES secrets that are bound to a specific pipeline group.'
    vendorName = 'sandro-h'
    vendorUrl = 'https://github.com/sandro-h/tenantsecrets'
    pluginProject = project(':plugin')
}

task tagRelease(type: Exec) {
    commandLine 'git', 'tag', "v${baseVersion}"
}

task pushTag(type: Exec) {
    commandLine 'git', 'push', 'origin', "v${baseVersion}"
    mustRunAfter tagRelease
}

task release {
    group 'Publishing'
    description 'Trigger release via GH Actions'
    dependsOn tagRelease, pushTag
}
